(()=>{"use strict";const e={enabled:!0,whitelist:[],pausedDomains:[],tier:{level:1,name:"Basic",unlockedAt:Date.now(),progress:0},notifications:!0,showBadge:!0,autoUpdate:!0,developerMode:!1},t={totalBlocked:0,blockedToday:0,blockedThisWeek:0,blockedThisMonth:0,lastReset:Date.now(),domainStats:{},categoryStats:{ads:0,trackers:0,malware:0,social:0,youtube:0,other:0}};class a{static instance;constructor(){}static getInstance(){return a.instance||(a.instance=new a),a.instance}async getSettings(){try{return(await chrome.storage.local.get("settings")).settings||e}catch(t){return e}}async setSettings(e){try{const t={...await this.getSettings(),...e};await chrome.storage.local.set({settings:t})}catch(e){}}async updateSettings(e){return this.setSettings(e)}async getStats(){try{return(await chrome.storage.local.get("stats")).stats||t}catch(e){return t}}async updateStats(e){try{const t={...await this.getStats(),...e};await chrome.storage.local.set({stats:t})}catch(e){}}async incrementBlockedCount(e,t="ads"){try{const a=await this.getStats(),s=(new Date).setHours(0,0,0,0);a.lastReset<s&&(a.blockedToday=0,a.lastReset=s),a.totalBlocked++,a.blockedToday++,a.domainStats[e]=(a.domainStats[e]||0)+1,a.categoryStats[t]++,await this.updateStats(a)}catch(e){}}async addToWhitelist(e){try{const t=await this.getSettings();t.whitelist.includes(e)||(t.whitelist.push(e),await this.setSettings({whitelist:t.whitelist}))}catch(e){}}async removeFromWhitelist(e){try{const t=await this.getSettings();t.whitelist=t.whitelist.filter(t=>t!==e),await this.setSettings({whitelist:t.whitelist})}catch(e){}}async isWhitelisted(e){try{return(await this.getSettings()).whitelist.some(t=>e===t||e.endsWith(`.${t}`))}catch(e){return!1}}async toggleExtension(){try{const e=!(await this.getSettings()).enabled;return await this.setSettings({enabled:e}),e}catch(e){return!0}}async clearStats(){try{await chrome.storage.local.set({stats:t})}catch(e){}}}const s=a.getInstance(),i=new Map,n=new Map;async function c(e){const t=["tier1_rules"],a=[];e>=2?t.push("tier2_rules"):a.push("tier2_rules"),e>=3?t.push("tier3_rules"):a.push("tier3_rules"),e>=4?t.push("tier4_rules","tier4_security_rules"):a.push("tier4_rules","tier4_security_rules"),e>=5?t.push("tier5_rules"):a.push("tier5_rules");try{await chrome.declarativeNetRequest.updateEnabledRulesets({enableRulesetIds:t,disableRulesetIds:a})}catch(e){}}function r(e){switch(e){case 2:return"YouTube ad blocking and advanced tracker blocking are now active!";case 3:return"Custom filters and element picker are now available!";case 4:return"Premium features unlocked! Enjoy malware protection and advanced privacy tools.";case 5:return"Ultimate protection activated! All features are now available.";default:return"New features unlocked!"}}function o(e){const t={16:"icons/icon-16.png",32:"icons/icon-32.png",48:"icons/icon-48.png",128:"icons/icon-128.png"};chrome.action.setIcon({path:t}),e||(chrome.action.setBadgeBackgroundColor({color:"#94a3b8"}),chrome.action.setBadgeText({text:"OFF"}))}async function l(e){const t=i.get(e),a=await s.getSettings(),c=n.get(e)||0;if(!a.enabled)return chrome.action.setBadgeText({text:"OFF",tabId:e}),void chrome.action.setBadgeBackgroundColor({color:"#94a3b8",tabId:e});if(t?.whitelisted)return void chrome.action.setBadgeText({text:"",tabId:e});const r=c>999?"999+":c>0?c.toString():"";if(chrome.action.setBadgeText({text:r,tabId:e}),c>0){const t=["#ef4444","#f97316","#eab308","#22c55e","#3b82f6"],s=a.tier.level||1,i=t[Math.min(s-1,4)]||"#ef4444";chrome.action.setBadgeBackgroundColor({color:i,tabId:e})}}async function d(){const e=await chrome.tabs.query({});for(const t of e)t.id&&l(t.id)}chrome.runtime.onInstalled.addListener(async e=>{if(chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:"view-tiers",title:"View Tier System",contexts:["action"]}),chrome.contextMenus.create({id:"separator-1",type:"separator",contexts:["action"]}),chrome.contextMenus.create({id:"open-options",title:"Options",contexts:["action"]}),chrome.contextMenus.create({id:"activate-element-picker",title:"Element Picker (Tier 3)",contexts:["page"]})}),"install"===e.reason){const e=await s.getSettings();await c(e.tier.level||1),o(e.enabled),chrome.tabs.create({url:chrome.runtime.getURL("options.html?welcome=true")})}else if("update"===e.reason){const e=await s.getSettings();await c(e.tier.level||1)}}),chrome.declarativeNetRequest.onRuleMatchedDebug?.addListener(async e=>{const{request:t,rule:a}=e;try{const e=new URL(t.url).hostname;if(await s.isWhitelisted(e))return;if(!(await s.getSettings()).enabled)return;const a=function(e){const t=e.toLowerCase();if(t.includes("youtube.com")&&(t.includes("/api/stats/")||t.includes("/pagead/")||t.includes("/ptracking")))return"youtube";if(t.includes("doubleclick")||t.includes("googlesyndication")||t.includes("adsystem")||t.includes("adserver")||t.includes("googleadservices")||t.includes("googlevideo.com/videoplayback"))return"ads";if(t.includes("analytics")||t.includes("metrics")||t.includes("tracking")||t.includes("beacon")||t.includes("mixpanel")||t.includes("segment")||t.includes("amplitude")||t.includes("hotjar")||t.includes("fullstory")||t.includes("mouseflow")||t.includes("clarity.ms")||t.includes("crazyegg"))return"trackers";if(t.includes("facebook")||t.includes("twitter")||t.includes("linkedin")||t.includes("pinterest")||t.includes("instagram")||t.includes("tiktok"))return"social";return"other"}(t.url);if(await s.incrementBlockedCount(e,a),t.tabId&&t.tabId>0){const a=n.get(t.tabId)||0;n.set(t.tabId,a+1),l(t.tabId),function(e,t){const a=i.get(e);a?a.blocked++:i.set(e,{tabId:e,domain:t,blocked:1,enabled:!0,whitelisted:!1})}(t.tabId,e)}}catch(e){}}),chrome.tabs.onUpdated.addListener(async(e,t,a)=>{if("loading"===t.status&&a.url)try{const t=new URL(a.url).hostname;n.set(e,0),i.set(e,{tabId:e,domain:t,blocked:0,enabled:!0,whitelisted:await s.isWhitelisted(t)}),l(e)}catch(e){}}),chrome.tabs.onRemoved.addListener(e=>{i.delete(e),n.delete(e)}),chrome.contextMenus.onClicked.addListener(async(e,t)=>{const a=await s.getSettings();switch(e.menuItemId){case"view-tiers":chrome.tabs.create({url:chrome.runtime.getURL("tiers-info.html")});break;case"open-options":chrome.runtime.openOptionsPage();break;case"activate-element-picker":a.tier.level>=3?t?.id&&chrome.tabs.sendMessage(t.id,{action:"activateElementPicker"}):chrome.tabs.create({url:chrome.runtime.getURL("tiers-info.html")})}}),chrome.runtime.onMessage.addListener((e,t,a)=>(async function(e,t,a){try{switch(e.action){case"getTabState":{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(e?.id){a(i.get(e.id)||{tabId:e.id,domain:e.url?new URL(e.url).hostname:"",blocked:n.get(e.id)||0,enabled:!0,whitelisted:!1})}else a(null);break}case"toggleExtension":{const e=await s.toggleExtension();o(e),d(),a({enabled:e});break}case"toggleWhitelist":{const t=e.domain,n=await s.isWhitelisted(t);n?await s.removeFromWhitelist(t):await s.addToWhitelist(t);(await chrome.tabs.query({})).forEach(e=>{if(e.id&&e.url&&e.url.includes(t)){const t=i.get(e.id);t&&(t.whitelisted=!n),l(e.id)}}),a({whitelisted:!n});break}case"getStats":a(await s.getStats());break;case"getSettings":a(await s.getSettings());break;case"clearStats":await s.clearStats(),n.clear(),d(),a({success:!0});break;case"tierUpgraded":{const t=e.tier;if(t>=1&&t<=5){const e=await s.getSettings(),i={1:"Basic",2:"Enhanced",3:"Professional",4:"Premium",5:"Ultimate"};await s.setSettings({...e,tier:{level:t,name:i[t],unlockedAt:Date.now(),progress:20*t}}),await c(t);(await chrome.tabs.query({})).forEach(e=>{e.id&&chrome.tabs.sendMessage(e.id,{action:"tierUpdated",tier:t}).catch(()=>{})}),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon-128.png"),title:`Tier ${t} Unlocked!`,message:r(t)}),a({success:!0,tier:t})}else a({success:!1,message:"Invalid tier upgrade"});break}case"accountCreated":{const e=await s.getSettings();if(e.tier.level<2){await s.setSettings({...e,tier:{level:2,name:"Enhanced",unlockedAt:Date.now(),progress:20}}),await c(2);(await chrome.tabs.query({})).forEach(e=>{e.id&&chrome.tabs.sendMessage(e.id,{action:"tierUpdated",tier:2}).catch(()=>{})}),chrome.notifications.create({type:"basic",iconUrl:chrome.runtime.getURL("icons/icon-128.png"),title:"Tier 2 Unlocked!",message:"YouTube ad blocking and advanced tracker blocking are now active!"}),a({success:!0,tier:2})}else a({success:!1,message:"Already at Tier 2 or higher"});break}case"adBlocked":if(t.tab?.id){const a=n.get(t.tab.id)||0;n.set(t.tab.id,a+1),l(t.tab.id);const i=e.category||"other",c=e.domain||new URL(t.tab.url||"").hostname;await s.incrementBlockedCount(c,i)}a({success:!0});break;default:a({error:"Unknown action"})}}catch(e){a({error:e instanceof Error?e.message:"Unknown error"})}}(e,t,a),!0)),setInterval(()=>{chrome.storage.local.get(null,()=>{})},2e4)})();
//# sourceMappingURL=background.js.map